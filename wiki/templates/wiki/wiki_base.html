<!doctype html>
<html lang="et">

<head>
  {% load static %}
  {% load crispy_forms_tags %}
  {% load wiki_extras %}

  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="description" content="Valga linna kroonika" />
  <meta name="keywords" content="Valga, linn, kroonika, ajalugu" />
  <meta name="author" content="Kalev Härk" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Kirjeldus FB jaoks -->
  <meta property="og:url" content="{{ request.build_absolute_uri }}" />
  <meta property="og:title" content="Valga linna kroonika" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="{{ object }}" />
  {% block fb_meta %}
  {% endblock fb_meta %}

  <!--  Laetavad moodulid-->
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <!-- Google reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js?render=explicit&onload=grecaptcha_onload"></script>

  {% block src %}{% endblock %}

  <!-- CSS -->
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <!-- <link rel="stylesheet" href={% static "wiki/css/w3.css" %}> -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'wiki/css/kroonika_general.css' %}">
  <!--  Alternatiivsed värvivalikud metro või colorful-->
  <link rel="stylesheet" href="{% static 'wiki/css/kroonika_color_metro.css' %}">
  <!-- <link rel="stylesheet" href={% static "wiki/css/kroonika_color_colorful.css" %}> -->

  {% block css %}{% endblock %}

  <link rel="shortcut icon" href="{% static 'wiki/img/favicon.ico' %}">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-151102639-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-151102639-1');
  </script>

</head>

<!-- Kroonika -->
<title>
  {% block title %}
    Valga linna kroonika
  {% endblock %}
</title>

<body class="Site w3-light-grey">


<!--Facebook plugin-->
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/et_EE/sdk.js#xfbml=1&version=v5.0"></script>
<header>
<!-- Navbar -->
<nav>
  <div class="w3-bar w3-left-align w3-large w3-padding">
    <a
        href="{% url 'algus' %}"
        title="Valga linna kroonika avalehele"
        class="w3-bar-item w3-button w3-hover-white">
        <img
            src="{% static 'wiki/img/220px-Valga_coat_of_arms.svg.png' %}"
            style='max-height:22px;'
            alt="vapp">
    </a>
    <a
      href="{% url 'algus' %}"
      class="w3-bar-item w3-button w3-hover-white">Valga linna kroonika
    </a>
    <button
        class="w3-bar-item w3-button w3-right w3-hide-large w3-hover-white"
        onclick="openRightMenu()">&#9776;
    </button>
    <!-- Search on large screens -->
    <form
        class="w3-hide-small"
        role="search"
        method="get"
        id="searchform_large"
        action="{% url 'wiki:otsi' %}" >
<!--      {% csrf_token %}-->
      <!--<input
          type="text"
          class="w3-bar-item w3-input w3-white"
          name="search"
          id="search"
          placeholder="Otsi.." />-->
      <button
          class="w3-bar-item w3-button w3-hide-small w3-hover-white"
          type="submit"
          id="searchsubmit_large"
          title="Otsi valitud fraasi järgi">
        <i class="fa fa-search"></i>
      </button>
    </form>
    <!--		Tagasiside saatmiseks -->
    <a
        class="w3-bar-item w3-button w3-hide-small w3-hover-white"
        title="Märkasid viga või oskad täiendada?"
        onclick="showFeedback()">
      <i class="fa fa-bug"></i>
    </a>
    <!-- Lingid erilehtedele -->
    <a
        href="{% url 'wiki:info' %}"
        class="w3-bar-item w3-button w3-hide-small w3-hover-white"
        title="Projektist">
      <i class="fa fa-info"></i>
    </a>
    <a
        href="{% url 'blog:blog_index' %}"
        class="w3-bar-item w3-button w3-hide-small w3-hover-white"
        title="Blogi">
      <i class="fa fa-comments-o"></i>
    </a>
    <a
        href="{% url 'ilm:index' %}"
        class="w3-bar-item w3-button w3-hide-medium w3-hide-small w3-hover-white"
        title="Valga linna ilm">
      <i class="fa fa-thermometer"></i>
    </a>
    <a
        href="https://et.wikipedia.org/wiki/Valga"
        target="blank"
        class="w3-bar-item w3-button w3-hide-medium w3-hide-small w3-hover-white"
        title="Wikipedia">
      <i class="fa fa-wikipedia-w"></i>
    </a>
	  <a
        href="https://www.facebook.com/valgalinn/"
        target="blank"
        class="w3-bar-item w3-button w3-hide-medium w3-hide-small w3-hover-white"
        title="Facebook">
      <i class="fa fa-facebook-official"></i>
    </a>

    <!-- Kasutaja ja adminlingid -->
    {% if user.is_authenticated %}
      <a
          href="{% url 'admin:index' %}"
          class="w3-bar-item w3-button w3-hide-medium w3-hide-small w3-text-grey w3-hover-white w3-right"
          title="Admin">
        <i class="fa fa-cog"></i>
      </a>
      <a
          href="{% url 'logout' %}?next={{ request.path | urlencode }}"
          class="w3-bar-item w3-button w3-hide-medium w3-hide-small w3-text-grey w3-hover-white w3-right"
          title="Logi välja">{{ user.first_name }}&nbsp;<i class="fa fa-sign-out"></i>
      </a>
      <!--      <a href={% url 'logout' %} class="w3-bar-item w3-button w3-hide-medium w3-hide-small w3-hover-white w3-right" title={{ user.first_name }}>{{ user.first_name }}&nbsp;<i class="fa fa-sign-out"></i></a>-->
    {% else %}
      <a
        href="{% url 'admin:index' %}"
        class="w3-bar-item w3-button w3-hide-medium w3-hide-small w3-text-grey w3-hover-white w3-right"
        title="Logi sisse">
      <i class="fa fa-sign-in"></i>
    </a>
    {% endif %}
  </div>

  <!-- Navbar on small screens -->
  <div class="w3-sidebar w3-bar-block w3-card w3-animate-right" style="display:none;right:0;" id="rightMenu">
    <button
        onclick="closeRightMenu()"
        class="w3-bar-item w3-button w3-large">
      <i class="fa fa-close"></i>
    </button>
    <a
        href="{% url 'wiki:wiki_artikkel_filter' %}"
        class="w3-bar-item w3-button">
      <i class="fa fa-search"></i>
      <span class="bar-item-text-with-icon">Otsi...</span>
    </a>
    <a
        onclick="showFeedback()"
        class="w3-bar-item w3-button">
      <i class="fa fa-bug"></i>
      <span class="bar-item-text-with-icon">Vigadest teatamine</span>
    </a>
    <a
        href="{% url 'blog:blog_index' %}"
        class="w3-bar-item w3-button">
      <i class="fa fa-comments-o"></i>
      <span class="bar-item-text-with-icon">Blogi</span>
    </a>
    <a
        href="{% url 'ilm:index' %}"
        class="w3-bar-item w3-button">
      <i class="fa fa-thermometer"></i>
      <span class="bar-item-text-with-icon">Valga linna ilm</span>
    </a>
    <a
        href="https://et.wikipedia.org/wiki/Valga"
        target="blank"
        class="w3-bar-item w3-button">
      <i class="fa fa-wikipedia-w"></i>
      <span class="bar-item-text-with-icon">Valga Vikipeedias</span>
    </a>
    <a
        href="https://www.facebook.com/valgalinn/"
        target="blank"
        class="w3-bar-item w3-button">
      <i class="fa fa-facebook-official"></i>
      <span class="bar-item-text-with-icon">Valga Facebook</span>
    </a>
    <a
        href="{% url 'wiki:info' %}"
        class="w3-bar-item w3-button"
        title="Projektist"><i class="fa fa-info"></i>
      <span class="bar-item-text-with-icon">Projektist</span>
    </a>
  </div>
</nav>
</header>
<main class="Site-content">
  <div class="w3-container">
  <!-- Süsteemiteadete näitamiseks -->
  <div>
    {% if messages %}
      <ul class="messagelist">
      {% for message in messages %}
        <div class="w3-panel">
          <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        </div>
      {% endfor %}
      </ul>
    {% endif %}
  </div>

  <!-- Search on small screens -->
  <div class="w3-row-padding w3-margin-bottom w3-hide-medium w3-hide-large">
    <form
        class="w3-hide-medium w3-hide-large"
        role="search"
        method="get"
        id="searchform_small"
        action="{% url 'wiki:wiki_artikkel_filter' %}" >
      {% csrf_token %}
      <input
          type="text"
          class="w3-bar-item w3-input w3-white w3-mobile"
          name="body_text__icontains"
          id="id_body_text__icontains"
          placeholder="Otsi.." />
      <button
          class="w3-bar-item w3-button w3-hide-small w3-hover-white"
          type="submit"
          id="searchsubmit_small"
          title="Otsi valitud fraasi järgi">
        <i class="fa fa-search"></i>
      </button>
      <button
          class="w3-bar-item w3-button w3-hide-small w3-hover-white"
          type="reset"
          id="searchreset"
          title="Uus otsing">
        <i class="fa fa-close"></i>
      </button>
    </form>
  </div>

  {% block content %} {% endblock %}
  </div>
</main>
<footer>
  <div class="w3-bar w3-padding">
    <a href="#">
	    <button class="w3-button w3-hover-white fa fa-angle-double-up"></button>
	  </a>
    <!--    FB-->
    <div
        class="fb-like"
        data-href="http://valgalinn.ee"
        data-width=""
        data-layout="button_count"
        data-action="like"
        data-size="small"
        data-show-faces="true"
        data-share="true">
    </div>
    <!--    Autoriõigused-->
    <a
        rel="license"
        href="http://creativecommons.org/licenses/by-sa/4.0/">
      <img
          alt="Creative Commonsi litsents"
          style="border-width:0"
          src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
      />
    </a>
    <small>
    "<span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Valga linna kroonika</span>" on antud Creative Commonsi litsentsi "
    <a
        rel="license"
        href="http://creativecommons.org/licenses/by-sa/4.0/">Autorile viitamine + Jagamine samadel tingimustel 4.0 Rahvusvaheline
    </a>" alla.
    </small>
    <a href="{% url 'wiki:info' %}">
        <button class="w3-button w3-hover-white w3-right w3-text-grey"><small>&#9400;&nbsp;2018-2019 Kalev Härk</small></button>
    </a>
  </div>
</footer>

</body>

<script>
function throttle(fn, delay) {
  let last;
  let timer;

  return () => {
    const now = +new Date;

    if (last && now < last + delay) {
      clearTimeout(timer);

      timer = setTimeout(() => {
        last = now;
        fn();
      }, delay);
    } else {
      last = now;
      fn();
    }

  };
}

function onScroll() {
  if ($(window).scrollTop() >= 60) {
    $('nav').addClass('fixed-header');
  }
  else {
    $('nav').removeClass('fixed-header');
  }
}

window.addEventListener('scroll', throttle(onScroll, 25));
</script>

<!-- Töötleb kõik reCAPTCHAga varustatud vormid -->
<script>
  function grecaptcha_onload() {
    $('.g-recaptcha-response').each(function( k, v ) {
      var submit = $(v).closest("form").find('[type="submit"]');
      grecaptcha.render( submit[0], {
        'sitekey' : '{% recaptcha_public_key %}',
        'callback' : function( token ) {
          $(v).closest("form").find('.g-recaptcha-response').val( token );
          $(v).closest("form").submit();
        },
        'size' : 'invisible',
      });
    });
  }
</script>

<!-- Väikese ekraani menüü (Opening and Collapsing the Navigation Bar) -->
<script>
function openRightMenu() {
  document.getElementById("rightMenu").style.display = "block";
}
function closeRightMenu() {
  document.getElementById("rightMenu").style.display = "none";
}
</script>

<!-- Load Facebook SDK for JavaScript -->
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "https://connect.facebook.net/et_EE/sdk.js#xfbml=1&version=v3.0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<script>
	function showFeedback() {
		var x = document.getElementById("panelFeedBack");
		if (x.className.indexOf("w3-show-block") == -1) {
			x.className += " w3-show-block";
			document.getElementById("id_kirjeldus").focus();
		} else {
			x.className = x.className.replace(" w3-show-block", "");
		}
	}
</script>

{% block javascript %} {% endblock %}
</html>