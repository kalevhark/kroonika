{% extends "wiki/wiki_base.html" %}

{% block breadcrumb %}
{% endblock %}

{% block src %}
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/heatmap.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
{% endblock %}

{% block content %}
{% load staticfiles %}
{% load wiki_extras %}
<div>
  <p>
    Valga linna süstematiseeritud ja veel süstematiseerimata kroonika
    seotuna isikute, organisatsioonide ja objektidega.
  </p>
  <p>
    Loodud kasutamiseks informatsioonilistel ja hariduslikel eesmärkidel.
    <br>
    Kogutud ja esitatud materjalid võivad olla ebatäpsed, mistõttu nende kasutamine on iga kasutaja enda riskil.
  </p>
  <p>
    Viidatud materjalid võivad olla nende autorite omand ja nende kasutamisel tuleb viidata algallikale.
  </p>
  <p>
    Kuupäevade puhul on kasutatud sel hetkel kasutatud kalendrit.
    <br>
    Ülevaade kalendrite kasutamisest ajaloos on <a target="blank" href="https://en.wikipedia.org/wiki/List_of_adoption_dates_of_the_Gregorian_calendar_per_country">siin</a></li>
  </p>
  {% if andmed.id__count > 0 %}
    Andmebaasis on {{ andmed.id__count }} artiklit {{ andmed.hist_searchdate__min|date:"d.m.Y" }} kuni {{ andmed.hist_searchdate__max|date:"d.m.Y" }}.
    <!--    Artiklite heatmap kuude kaupa-->
    <div id="container" style="height: 300px; min-width: 310px; max-width: 1000px; margin: 0 auto"></div>
  {% endif %}
</div>

<p>
  Parandatud on ilmsed vead. Vastukäivate andmete puhul on järjekord:
  <br>
  Arhiivimaterjalid -> Teatmeteosed -> Kroonikaraamatud -> Vikipeedia -> muud andmekogud
</p>

<p>Otsimiseks kasuta temaatilisi otsinguid:
  <a href={% url 'wiki:wiki_artikkel_filter' %}>Artiklid</a>
  <a href={% url 'wiki:wiki_isik_filter' %}>Isikud</a>
  <a href={% url 'wiki:wiki_organisatsioon_filter' %}>Organisatsioonid</a>
  <a href={% url 'wiki:wiki_objekt_filter' %}>Objektid</a>
</p>

<p>
  <form id="form" method="post" action="{% url 'wiki:mine_krono_kp' %}">
    {% csrf_token %}
    ...või vali kuupäev:
    <input type="date" name="kuup2ev" value="1902-02-24">
    <input type="hidden" value="" name="g-recaptcha-response" class="g-recaptcha-response" >
    <input type="submit" value="Vaata">
  <!--    <input type="hidden" name="g-recaptcha-response" id='recaptcha'>-->
  </form>
</p>

<p>
  ...või otseteed wiki/krono/aasta/kuu/päev,
  näiteks <i>wiki/krono/1971/03/15</i>.
</p>
<div>
  Andmebaasid:
  <ul>
    {% for a in andmebaasid%}
      <li>{{a}}
    {% endfor %}
  </ul>
</div>
Andmebaasi- ja veebilahenduse tegi {% kalev %}.<br>
Testserveri eest suured tänud: Margo Pärnaku, Siim Somma!<br>

Abiks:
<ul>
  <li><a href="https://www.python.org/">Python</a></li>
  <li><a href="https://www.djangoproject.com/">Django</a></li>
  <li><a href="https://mariadb.com/">MariaDB</a></li>
  <li><a href="http://apache.org/">Apache</a></li>
</ul>
Lisaks:
<ul>
  <li><a href="https://www.w3schools.com/">W3Schools</a></li>
  <li><a href="https://github.com/carltongibson/django-filter">django-filter</a></li>
  <li><a href="https://github.com/jazzband/django-widget-tweaks">django-widget-tweaks</a></li>
  <li><a href="https://www.django-rest-framework.org/">Django REST framework</a></li>
</ul>

<div>
{% render_logged_in_user_list %}
</div>
<div>
  Revision: {{ revision_data.kroonika }}/{{ revision_data.revised }}<br>
  {% if revision_data.viiteta %}
    Viiteta:
    {% for pk in revision_data.viiteta %}
      &nbsp;<a class="hover-artikkel" href={% url 'wiki:wiki_artikkel_detail' pk=pk %}>{{ pk }}</a>
    {% endfor %}
  {% endif %}
</div>


<!--<script>-->
<!--  grecaptcha.ready(function() {-->
<!--    $('#form').submit(function(e){-->
<!--      var form = this;-->
<!--      e.preventDefault()-->
<!--      grecaptcha.execute('{{recaptcha_key}}' , {action: '{% url 'wiki:mine_krono_kp' %}'}).then(function(token) {-->
<!--        $('#recaptcha').val(token)-->
<!--        form.submit()-->
<!--      });-->
<!--    })-->
<!--  });-->
<!--</script>-->

{% endblock %}

{% block javascript %}
<script>
// Artiklite heatmap aastate ja kuude kaupa
Highcharts.chart('container', {

    // data: {
    //    csv: document.getElementById('csv').innerHTML
    // },

    chart: {
        type: 'heatmap',
        margin: [60, 10, 80, 50]
    },

    title: {
        text: 'Artikleid andmebaasis (n={{ andmed.id__count }})',
        align: 'left',
        x: 40
    },

    subtitle: {
        text: 'Aastatel {{ andmed.hist_searchdate__min|date:"Y" }}-{{ andmed.hist_searchdate__max|date:"Y" }} kuude kaupa',
        align: 'left',
        x: 40
    },

    xAxis: {
        min: {{ andmed.hist_searchdate__min|date:"Y" }},
        max: {{ andmed.hist_searchdate__max|date:"Y" }},
        labels: {
            align: 'left',
            x: 5,
            y: 14
        },
        showLastLabel: false,
        tickLength: 16
    },

    yAxis: {
        title: {
            text: 'kuud'
        },
        labels: {
            format: '{value}'
        },
        minPadding: 0,
        maxPadding: 0,
        startOnTick: false,
        endOnTick: false,
        tickPositions: [3, 6, 9, 12],
        tickWidth: 1,
        min: 0,
        max: 12,
        reversed: false
    },

    colorAxis: {
        stops: [
            [0, '#3060cf'],
            [0.5, '#fffbbc'],
            [0.9, '#c4463a'],
            [1, '#c4463a']
        ],
        min: 1,
        max: 30,
        startOnTick: false,
        endOnTick: false,
        labels: {
            format: '{value}'
        }
    },

    series: [{
        borderWidth: 0,
        data: {{ artikleid_kuus }},
        // nullColor: '#EFEFEF',
        // colsize: 24 * 36e5, // one day
        tooltip: {
           headerFormat: 'Artikleid:<br/>',
           pointFormat: '{point.x} {point.y}: <b>{point.value}</b>'
        },
        // turboThreshold: Number.MAX_VALUE // #3404, remove after 4.0.5 release
    }]

});
</script>
{% endblock %}