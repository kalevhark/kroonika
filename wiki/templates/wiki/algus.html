{% extends "wiki/wiki_base.html" %}
{% load static %}
{% block breadcrumb %}
{% endblock %}

{% block src %}
{% endblock %}

{% block css %}
{% endblock %}

{% block content %}
<div class="w3-container">
  <h4>Testlehekülg</h4>
  {% load crispy_forms_tags %}
  <div id="panelFeedBack" class="w3-panel w3-padding w3-card-4 w3-light-grey w3-hide">
    {% crispy feedbackform %}
  </div>
	<!-- Lingid teemalehtedele -->
	<div class="w3-row-padding w3-margin-bottom">
    {% include 'wiki/includes/algus_head.html' %}
  </div>
  <!-- Sisu algab siit -->
  <div class="w3-row-padding w3-margin-bottom">
    {% now "d" as p2ev %}
    {% now "m" as kuu %}
    {% now "Y" as aasta %}
    <!-- Artiklite esitlus -->
	  <div class="w3-quarter">
      <!-- Teadete esitamiseks -->
<!--      <div class="w3-container w3-hover-white">-->
<!--        {% include 'wiki/includes/wiki_message.html' %}-->
<!--      </div>-->
      <div class="w3-container w3-padding-16 w3-hover-white">
        {% include 'wiki/includes/wiki_calendar.html' %}
        <div id="algus_artikkel"></div>
      </div>
    </div>
    <!-- Isikute esitlus -->
    <div class="w3-quarter">
      <div class="w3-container w3-padding-16 w3-hover-white">
        <div id="algus_isik"></div>
      </div>
    </div>
    <!-- Organisatsioonide esitlus -->
    <div class="w3-quarter">
      <div class="w3-container w3-padding-16 w3-hover-white">
        <div id="algus_organisatsioon"></div>
      </div>
    </div>
	  <!-- Objektide esitlus -->
    <div class="w3-quarter">
      <div class="w3-container w3-padding-16 w3-hover-white">
        <div id="algus_objekt"></div>
      </div>
      <!-- Kaardid -->
      <div class="w3-container background-objekt w3-padding-16">
        <div class="w3-left">
          <i class="fa fa-map w3-xxxlarge"></i>
        </div>
        <div class="w3-hide-medium w3-right">
          <h4>Kaardid</h4>
        </div>
        <div class="w3-hide-large w3-hide-small w3-right ">
          <h6>Kaardid</h6>
        </div>
      </div>

      <div class="w3-margin-top">
        {% include 'wiki/includes/kaart_slideshow.html' %}
      </div>
    </div>
  </div>
  <div class="w3-row-padding w3-margin-bottom w3-hide-small">
    {% include 'wiki/includes/algus_foot.html' %}
  </div>
</div>
{% endblock %}

{% block javascript %}
<script>
  function getModelData(value) {
    let divId = '#algus_' + value['model'];
    $.ajax(
      {
        url: value['url'],
        success: function(data) {
          $(divId).html(data);
        },
        error: function (jqXHR, exception) {
          var msg = '';
          if (jqXHR.status === 0) {
              msg = 'Not connect.\n Verify Network.';
          } else if (jqXHR.status == 404) {
              msg = 'Requested page not found. [404]';
          } else if (jqXHR.status == 500) {
              msg = 'Internal Server Error [500].';
          } else if (exception === 'parsererror') {
              msg = 'Requested JSON parse failed.';
          } else if (exception === 'timeout') {
              msg = 'Time out error.';
          } else if (exception === 'abort') {
              msg = 'Ajax request aborted.';
          } else {
              msg = 'Uncaught Error.\n' + jqXHR.responseText;
          }
          $(divId).html(msg);
          <!-- Proovime 5 s pärast uuesti -->
          {
            window.setTimeout(get_model_data(url), 50000);
          };
        },
      }
    );
  };

  $( document ).ready(function() {
    <!-- kalendrisisu -->
    let artikleidKuudeKaupa = {{ andmed.artikleid_kuu_kaupa }};
    <!-- näitame sisu -->
    let models = [
      {'model': 'artikkel', 'url': "{% url 'wiki:ukj_test_artikkel_detail' %}"},
      {'model': 'isik', 'url': "{% url 'wiki:ukj_test_isik_detail' %}"},
      {'model': 'organisatsioon', 'url': "{% url 'wiki:ukj_test_organisatsioon_detail' %}"},
      {'model': 'objekt', 'url': "{% url 'wiki:ukj_test_objekt_detail' %}"}
    ];
    models.forEach(getModelData);
  });
</script>

<script src="{% static 'wiki/js/wiki_calendar.js'%}"></script>

{% endblock %}
